<!DOCTYPE html>
<style>

    body {
        height : 100%;
        width : 100%;
    }
    canvas { 
        background-color: #141414;
        display: block;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
    }
    button {
        position: absolute;
        user-select: none;
        background-color: rgb(7, 120, 185);
        border: 0px;
        border-radius: 10px;
        width: 200px;
        height: 50px;
        font-size: 24px;
        transition: background-color 0.2s;
        --clicked: 0;
    }

    .button2 {
        left: 221px
    }
    .slider {
        position: relative;
        user-select: none;
        width: 200;
        background-color: #141414;




    }
    div {
        position: absolute;
        user-select: none; 
        font-size: 23px;
        text-align: center;
        top: 100px;
    }
    input {
        position: relative;
        user-select: none; 
        width: 100px;

    }


</style>
<html>
<canvas id="canvas"></canvas>
<button id="add" class="button1">Add a planet</button>
<button id="remove" class="button2">Remove a planet</button>

    









</html>

<script>
	document.getElementById("canvas").width = window.innerWidth 
	document.getElementById("canvas").height = window.innerHeight 
    const addButton = document.getElementById("add");
    const removeButton = document.getElementById("remove");
    const ctx = document.getElementById("canvas").getContext('2d');
    let state = "default";
    let planets = [];
    let cameraX = 0;
    let cameraY = 0;
    let cameraZ = 0.51315811823;
    let G = 5;
    let time = 1;
    let leftPressed = false;
    let upPressed = false;
    let downPressed = false;
    let rightPressed = false;
    class planet {
        constructor(mass,x,y,xv,yv,color) {
            this.mass = mass;
            this.x = x;
            this.y = y;
            this.xv = xv;
            this.yv = yv;
            this.color = color;
        }
    
    }
    function createPlanet(m,x,y,xv,yv,color) {
        planets.push(new planet(m,x,y,xv,yv,color));

    }

    function drawPlanet(m,x,y,color) {
        let r = Math.round(Math.sqrt(m/Math.PI)) * 20;
        ctx.beginPath();
        ctx.arc((x - cameraX) * cameraZ + window.innerWidth / 2,(y - cameraY) * cameraZ  + window.innerHeight  / 2,r * cameraZ,0,Math.PI*2, true);
        ctx.fillStyle = color;
        ctx.fill();
    }

	function calculatePlanets(list) {

		for (i=0;i<list.length;i++) {
			//calculate the gavity from other bodys
			for (j=0;j<list.length;j++) {
				if (list[i].x == list[j].x && list[i].y == list[j].y) {continue}

                let differanceX = list[j].x - list[i].x;
                let differanceY = list[j].y - list[i].y;

                // Calculate DeltaV from Gravity
                let dist = Math.sqrt(differanceX * differanceX + differanceY * differanceY)
                let F = G * (list[i].mass * list[j].mass / (dist * dist))
                let dir = Math.atan2(differanceX,differanceY);
                list[i].xv += F * Math.sin(dir);
                list[i].yv += F * Math.cos(dir);
            
			}
            list[i].x += list[i].xv / list[i].mass * 50 * time;
			list[i].y += list[i].yv / list[i].mass * 50 * time;
		}


	}

    function getDistance(x1, y1, x2, y2) {

        let y = x2 - x1;
        let x = y2 - y1;
        return Math.sqrt(x * x + y * y);

    }

    function planetAtPoint(list,x,y) {
        for (i=0;i<list.length;i++) {
            if (getDistance(list[i].x, list[i].y,x,y) < Math.round(Math.sqrt(list[i].mass/Math.PI)) * 20) {return i}
            

        }
        return -1;
    }

    function drawPlanetsFromList(list) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (i=0;i<list.length;i++) {
            drawPlanet(list[i].mass, list[i].x, list[i].y, list[i].color);
        }
    }

    function updateFrame() {
        // time = document.getElementById('time').
        if (leftPressed) {cameraX -= 10 / cameraZ}
        if (rightPressed) {cameraX += 10 / cameraZ}
        if (upPressed) {cameraY -= 10 / cameraZ}
        if (downPressed) {cameraY += 10 / cameraZ}
        calculatePlanets(planets);
        drawPlanetsFromList(planets);

    }

    function removeButtonClicked() {
        if (state != "remove") {state = "remove";addButton.style.backgroundColor = '#1b8ac2';removeButton.style.backgroundColor = '#adcfe0';} else {state = "default";removeButton.style.backgroundColor = '#1b8ac2';addButton.style.backgroundColor = '#1b8ac2';}
    }

    function addButtonClicked() {
        if (state != "add") {state = "add";removeButton.style.backgroundColor = '#1b8ac2';addButton.style.backgroundColor = '#adcfe0';} else {state = "default";removeButton.style.backgroundColor = '#1b8ac2';addButton.style.backgroundColor = '#1b8ac2';}
    }

    function mouseButtonClicked(event) {
        if (state == "remove") {
            
            let removedPlanet = planetAtPoint(planets,(event.clientX - window.innerWidth / 2) / cameraZ + cameraX,(event.clientY - window.innerHeight / 2) / cameraZ + cameraY);
            if (removedPlanet >= 0) {planets.splice(removedPlanet,1)}
            state = "default";
            removeButton.style.backgroundColor = '#1b8ac2';
            addButton.style.backgroundColor = '#1b8ac2';

        }
        if (state == "add") {
            let mass = parseInt(prompt("Input mass 1-10,000"));
            let xv = parseInt(prompt("Input x velocity -30-30")) * mass / 20;
            let yv = parseInt(prompt("Input y velocity -30-30")) * -1 * mass / 20;
            createPlanet(mass,(event.clientX - window.innerWidth / 2) / cameraZ + cameraX,(event.clientY - window.innerHeight / 2) / cameraZ + cameraY,xv,yv,"#" + ((1<<24)*Math.random() | 0).toString(16))
            state = "default";
            removeButton.style.backgroundColor = '#1b8ac2';
            addButton.style.backgroundColor = '#1b8ac2';

        }

    }

    createPlanet(400,0,0,0,0, "#" + ((1<<24)*Math.random() | 0).toString(16));
    createPlanet(50,0,1000,10,0, "#" + ((1<<24)*Math.random() | 0).toString(16));
    id = setInterval(updateFrame,33);


    document.getElementById('remove').addEventListener('click', removeButtonClicked);
    document.getElementById('add').addEventListener('click', addButtonClicked);
    document.getElementById('canvas').addEventListener("click", mouseButtonClicked);

    document.addEventListener('keydown', function(event) {
    if(event.keyCode == 37 || event.keyCode == 65) {
        leftPressed = true;
    }
    if(event.keyCode == 38 || event.keyCode == 87) {
        upPressed = true;
    }
    else if(event.keyCode == 39 || event.keyCode == 68) {
        rightPressed = true;
    }
    else if(event.keyCode == 40 || event.keyCode == 83) {
        downPressed = true;
    }
    });
document.addEventListener('keyup', function(event) {
    if(event.keyCode == 37 || event.keyCode == 65) {
        leftPressed = false;
    }
    if(event.keyCode == 38 || event.keyCode == 87) {
        upPressed = false;
    }
    else if(event.keyCode == 39 || event.keyCode == 68) {
        rightPressed = false;
    }
    else if(event.keyCode == 40 || event.keyCode == 83) {
        downPressed = false;
    }
    });

    var scrollableElement = document.body; //document.getElementById('scrollableElement');

scrollableElement.addEventListener('wheel', checkScrollDirection);

function checkScrollDirection(event) {
  if (checkScrollDirectionIsUp(event)) {
    cameraZ *= 1.1;
  } else {
    cameraZ /= 1.1;
  }
}

function checkScrollDirectionIsUp(event) {
  if (event.wheelDelta) {
    return event.wheelDelta > 0;
  }
  return event.deltaY < 0;
}
    

    
    </script>
